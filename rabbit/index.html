<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=0.5,user-scalable=no"><title>Rabbit Maze Game</title><style>html,body{background:#000;width:100%;height:100%;margin:0;padding:0;font-family:monospace;overflow:hidden}canvas{background:#000;width:100%;height:100%;display:block}</style></head><body> <canvas id="gameCanvas"></canvas> <script type="module">let t,e;class i{constructor(t){this.canvas=t,this.inputLocked=!1,this.inputDx=0,this.inputDy=0,this.userScale=1,this.targetUserScale=1,this.pinchActive=!1,this.zoomActive=!1,this.zoomTimeout=null,this.startTouches=[],this.handleKeyDown=this.handleKeyDown.bind(this),this.handleTouchStart=this.handleTouchStart.bind(this),this.handleTouchMove=this.handleTouchMove.bind(this),this.handleTouchEnd=this.handleTouchEnd.bind(this),this.handleWheel=this.handleWheel.bind(this),this.initEventListeners()}initEventListeners(){window.addEventListener("keydown",this.handleKeyDown),this.canvas.addEventListener("touchstart",this.handleTouchStart,{passive:!1}),this.canvas.addEventListener("touchmove",this.handleTouchMove,{passive:!1}),this.canvas.addEventListener("touchend",this.handleTouchEnd,{passive:!1}),this.canvas.addEventListener("wheel",this.handleWheel,{passive:!1}),this.canvas.addEventListener("contextmenu",t=>t.preventDefault(),!1)}lockInput(){this.inputLocked=!0}unlockInput(){this.inputLocked=!1}getDirection(){return{dx:this.inputDx,dy:this.inputDy}}resetDirection(){this.inputDx=0,this.inputDy=0}getUserScale(){return this.userScale}animateScaleBack(){if(!this.pinchActive&&!this.zoomActive){if(.001>Math.abs(this.userScale-this.targetUserScale)){this.userScale=this.targetUserScale;return}this.userScale+=(this.targetUserScale-this.userScale)*.1,requestAnimationFrame(()=>this.animateScaleBack())}}distance(t,e){let i=t.x-e.x,h=t.y-e.y;return Math.sqrt(i*i+h*h)}handleKeyDown(t){if(this.inputLocked)return;let e=0,i=0;"ArrowUp"===t.key?i=-1:"ArrowDown"===t.key?i=1:"ArrowLeft"===t.key?e=-1:"ArrowRight"===t.key&&(e=1),(0!==e||0!==i)&&(this.inputDx=e,this.inputDy=i)}handleTouchStart(t){this.inputLocked||(t.preventDefault(),1===t.touches.length?(this.startTouches=[{x:t.touches[0].clientX,y:t.touches[0].clientY}],this.pinchActive=!1):2===t.touches.length&&(this.pinchActive=!0,this.startTouches=[{x:t.touches[0].clientX,y:t.touches[0].clientY},{x:t.touches[1].clientX,y:t.touches[1].clientY}]))}handleTouchMove(t){if(!this.inputLocked&&(t.preventDefault(),2===t.touches.length)){let e=this.distance(this.startTouches[0],this.startTouches[1]),i=this.distance({x:t.touches[0].clientX,y:t.touches[0].clientY},{x:t.touches[1].clientX,y:t.touches[1].clientY});this.userScale=i/e}}handleTouchEnd(t){if(!this.inputLocked){if(t.preventDefault(),0!==t.touches.length||this.pinchActive||1!==this.startTouches.length)0===t.touches.length&&this.pinchActive&&(this.pinchActive=!1,this.targetUserScale=1,this.animateScaleBack());else{let e=t.changedTouches[0].clientX,i=t.changedTouches[0].clientY,h=e-this.startTouches[0].x,s=i-this.startTouches[0].y;Math.abs(h)>Math.abs(s)?(this.inputDx=h>0?1:-1,this.inputDy=0):(this.inputDy=s>0?1:-1,this.inputDx=0),this.startTouches=[]}}}handleWheel(t){if(!this.inputLocked&&(t.preventDefault(),t.ctrlKey)){this.zoomActive=!0;let e=1-.001*t.deltaY;this.userScale*=e,this.userScale<.1&&(this.userScale=.1),this.userScale>5&&(this.userScale=5),this.zoomTimeout&&clearTimeout(this.zoomTimeout),this.zoomTimeout=setTimeout(()=>{this.zoomActive=!1,this.targetUserScale=1,this.animateScaleBack()},300)}}}function h(t,e,i,h){let s=[];for(let i=0;i<e;i++){let e=[];for(let i=0;i<t;i++)e.push({north:!0,south:!0,east:!0,west:!0,hole:!1});s.push(e)}!function i(h,a){let l=[[0,1],[0,-1],[1,0],[-1,0]];for(let t=l.length-1;t>0;t--){let e=Math.floor(Math.random()*(t+1));[l[t],l[e]]=[l[e],l[t]]}for(let[n,o]of l){let l=h+n,r=a+o;l>=0&&l<e&&r>=0&&r<t&&s[l][r].north&&s[l][r].south&&s[l][r].east&&s[l][r].west&&(-1===n&&(s[h][a].north=!1,s[l][r].south=!1),1===n&&(s[h][a].south=!1,s[l][r].north=!1),-1===o&&(s[h][a].west=!1,s[l][r].east=!1),1===o&&(s[h][a].east=!1,s[l][r].west=!1),i(l,r))}}(0,0);let a=Array.from({length:e},()=>Array(t).fill(-1));a[h][i]=0;let l=[{y:h,x:i}];for(;l.length>0;){let{y:i,x:h}=l.shift(),n=s[i][h],o=a[i][h];!n.north&&i>0&&-1===a[i-1][h]&&(a[i-1][h]=o+1,l.push({y:i-1,x:h})),!n.south&&i<e-1&&-1===a[i+1][h]&&(a[i+1][h]=o+1,l.push({y:i+1,x:h})),!n.west&&h>0&&-1===a[i][h-1]&&(a[i][h-1]=o+1,l.push({y:i,x:h-1})),!n.east&&h<t-1&&-1===a[i][h+1]&&(a[i][h+1]=o+1,l.push({y:i,x:h+1}))}let n=-1,o=h,r=i;for(let i=0;i<e;i++)for(let e=0;e<t;e++)a[i][e]>n&&(n=a[i][e],o=i,r=e);return s[o][r].hole=!0,s}function s(t,e,i,h,a,l=1,n=1,o=0,r=null,c="#75FA5C"){o&&(void 0===s.lastBlinkTime&&(s.lastBlinkTime=o,s.isEyeBlinking=!1),!s.isEyeBlinking&&o-s.lastBlinkTime>3e3&&(s.isEyeBlinking=!0,s.lastBlinkTime=o),s.isEyeBlinking&&o-s.lastBlinkTime>200&&(s.isEyeBlinking=!1,s.lastBlinkTime=o));let T=!!o&&s.isEyeBlinking;t.save(),t.globalAlpha=l;let u=h/19*.8*n;t.translate(e+h/2,i+h/2),a?t.scale(-u,u):t.scale(u,u),t.translate(-9.5,-10),t.fillStyle=c,r||(t.beginPath(),t.moveTo(10.5,7.00008),t.lineTo(12,7.00008),t.lineTo(12,6.00008),t.lineTo(11,6.00008),t.lineTo(11,5.00008),t.lineTo(10,5.00008),t.lineTo(10,4.00008),t.lineTo(9,4.00008),t.lineTo(9,2.00008),t.lineTo(8,2.00005),t.lineTo(8,.500087),t.lineTo(9,.5),t.lineTo(9,1.5),t.lineTo(10,1.5),t.lineTo(10,2.5),t.lineTo(11,2.5),t.lineTo(11,3.5),t.lineTo(12,3.5),t.lineTo(12,5.00008),t.lineTo(13,5.00008),t.lineTo(13,3),t.lineTo(12,3),t.lineTo(12,2.00008),t.lineTo(11,2.00005),t.lineTo(11,.500087),t.lineTo(12,.500087),t.lineTo(12,1.5),t.lineTo(12.498,1.5),t.lineTo(13,2.00008),t.lineTo(13,2.5),t.lineTo(13.7328,2.5),t.lineTo(13.7328,3.5),t.lineTo(14.5,3.5),t.lineTo(14.5,6.00008),t.lineTo(17.5,6.00008),t.lineTo(17.5,7.00008),t.lineTo(18.5,7.00008),t.lineTo(18.5,11),t.lineTo(18,12),t.lineTo(16,12),t.lineTo(16,13),t.lineTo(15,13),t.lineTo(15,15),t.lineTo(13.7637,15),t.lineTo(13.9114,10),t.lineTo(17,10),t.lineTo(17,7.00008),t.lineTo(14,7.00008),t.lineTo(13.7637,15),t.lineTo(13,15),t.lineTo(13,16.5),t.lineTo(11,16.5),t.lineTo(11,18),t.lineTo(12,18),t.lineTo(12,19),t.lineTo(13,19),t.lineTo(13,19.5),t.lineTo(10,19.5),t.lineTo(10,18.5),t.lineTo(9,18.5),t.lineTo(9,17.5),t.lineTo(7,17.5),t.lineTo(7,17),t.lineTo(8,17),t.lineTo(8,16.0452),t.lineTo(9,16.0452),t.lineTo(9,13),t.lineTo(8,13),t.lineTo(8,15),t.lineTo(7.26716,15),t.lineTo(7,15.5),t.lineTo(6,15.5),t.lineTo(6,18),t.lineTo(7,18),t.lineTo(7,19),t.lineTo(8,19),t.lineTo(8,19.5),t.lineTo(6,19.5),t.lineTo(6,19),t.lineTo(5.5,19),t.lineTo(5,19),t.lineTo(5,18.5),t.lineTo(4.5,18.5),t.lineTo(4,18.5),t.lineTo(4,18),t.lineTo(3.5,18),t.lineTo(3.5,17.5),t.lineTo(3,17.5),t.lineTo(3,17),t.lineTo(4,17),t.lineTo(4,16.0452),t.lineTo(3,16.0452),t.lineTo(3,15),t.lineTo(1,15),t.lineTo(1,14),t.lineTo(.5,14),t.lineTo(.5,13.5),t.lineTo(0,13.5),t.lineTo(0,12),t.lineTo(1,12),t.lineTo(1,11),t.lineTo(3,11),t.lineTo(3,12),t.lineTo(4,12),t.lineTo(4,10),t.lineTo(5,10),t.lineTo(5,9),t.lineTo(6,9),t.lineTo(6,8),t.lineTo(7.26716,8),t.lineTo(7.26716,7.00008),t.lineTo(10.5,7.00008),t.closePath(),t.fill(),T?(t.fillStyle="black",t.fillRect(15,8,2,2)):(t.fillStyle=c,t.fillRect(15,8,1,1))),t.restore()}"undefined"!=typeof window&&(window.generateMaze=h),"undefined"!=typeof window&&(window.drawRabbit=s);class a{constructor(t,e){this.canvas=t,this.ctx=t.getContext("2d"),this.inputManager=e;let i=window.innerWidth,h=window.innerHeight;this.cellSize=80,this.baseMazeWidth=Math.ceil(i/this.cellSize),this.baseMazeHeight=Math.ceil(h/this.cellSize),this.mazeWidth=this.baseMazeWidth,this.mazeHeight=this.baseMazeHeight,this.level=1,this.holeX=Math.floor(this.mazeWidth/2),this.holeY=Math.floor(this.mazeHeight/2),this.rabbitX=this.holeX,this.rabbitY=this.holeY,this.maze=null,this.trail=[],this.facingLeft=!1,this.cameraX=0,this.cameraY=0,this.targetCameraX=0,this.targetCameraY=0,this.rabbitAlpha=0,this.rabbitScale=.1,this.teleportingIn=!0,this.teleportingOut=!1,this.transitionAlpha=0,this.gameOver=!1,this.gameOverAlpha=0,this.lives=3,this.flashAlpha=0,this.panelAlpha=1,this.idleThreshold=2e3,this.lastUserActionTime=performance.now()}getMaze(){return this.maze||(this.maze=h(this.mazeWidth,this.mazeHeight,this.holeX,this.holeY)),this.maze}resizeCanvas(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.drawScene()}start(){this.animate()}animate(){this.update(),this.drawScene(),requestAnimationFrame(()=>this.animate())}update(){this.time=performance.now();let{dx:t,dy:e}=this.inputManager.getDirection();this.inputManager.resetDirection(),(0!==t||0!==e)&&(this.lastUserActionTime=this.time),t>0?this.facingLeft=!1:t<0&&(this.facingLeft=!0),this.tryMove(t,e),this.updateCameraTarget(),this.smoothCameraMovement(),this.updateRabbitTeleport(),this.updateGameOver(),this.flashAlpha>0&&(this.flashAlpha-=.05,this.flashAlpha<0&&(this.flashAlpha=0),0==this.flashAlpha&&(this.panelAlpha=1)),this.time-this.lastUserActionTime>this.idleThreshold?(this.panelAlpha+=.005,this.panelAlpha>1&&(this.panelAlpha=1)):!this.flashAlpha&&(this.panelAlpha-=.02,this.panelAlpha<0&&(this.panelAlpha=0))}tryMove(t,e){if(this.teleportingIn||this.teleportingOut||this.gameOver)return;if(0===t&&0===e){this.hasAnyMoves(this.rabbitX,this.rabbitY)||(this.lives>1?(this.lives--,this.flashAlpha=1,this.panelAlpha=1,this.lastUserActionTime=performance.now(),this.trail=[]):this.gameOver=!0);return}let i=this.rabbitX,h=this.rabbitY;this.canMove(this.rabbitX,this.rabbitY,t,e)?(this.rabbitX+=t,this.rabbitY+=e,this.trail.push({x:i,y:h}),this.trail.length>1e3&&this.trail.shift(),this.getMaze()[this.rabbitY][this.rabbitX].hole&&(this.teleportingOut=!0)):this.hasAnyMoves(this.rabbitX,this.rabbitY)||(this.lives>1?(this.lives--,this.flashAlpha=1,this.trail=[]):this.gameOver=!0)}hasAnyMoves(t,e){for(let[i,h]of[[1,0],[-1,0],[0,1],[0,-1]])if(this.canMove(t,e,i,h))return!0;return!1}canMove(t,e,i,h){let s=this.getMaze()[e][t];if(1===i&&s.east||-1===i&&s.west||1===h&&s.south||-1===h&&s.north)return!1;let a=t+i,l=e+h;if(a<0||a>=this.mazeWidth||l<0||l>=this.mazeHeight)return!1;for(let t=0;t<this.trail.length;t++)if(this.trail[t].x===a&&this.trail[t].y===l)return!1;return!0}updateCameraTarget(){let t=this.inputManager.getUserScale(),e=this.cellSize*t,i=Math.floor(this.canvas.width/e),h=Math.floor(this.canvas.height/e),s=this.rabbitX-Math.floor(i/2),a=this.rabbitY-Math.floor(h/2);s<0&&(s=0),a<0&&(a=0),s+i>this.mazeWidth&&(s=this.mazeWidth-i),a+h>this.mazeHeight&&(a=this.mazeHeight-h),this.targetCameraX=s*this.cellSize,this.targetCameraY=a*this.cellSize}smoothCameraMovement(){this.cameraX+=(this.targetCameraX-this.cameraX)*.1,this.cameraY+=(this.targetCameraY-this.cameraY)*.1,.001>Math.abs(this.targetCameraX-this.cameraX)&&(this.cameraX=this.targetCameraX),.001>Math.abs(this.targetCameraY-this.cameraY)&&(this.cameraY=this.targetCameraY)}updateRabbitTeleport(){this.teleportingIn&&(this.rabbitAlpha+=.02,this.rabbitScale+=.02,this.transitionAlpha-=.02,this.transitionAlpha<0&&(this.transitionAlpha=0),this.rabbitAlpha>=1&&this.transitionAlpha<=0&&(this.rabbitAlpha=1,this.rabbitScale=1,this.teleportingIn=!1)),this.teleportingOut&&(this.rabbitAlpha-=.02,this.rabbitScale-=.02,this.transitionAlpha+=.02,this.rabbitAlpha<=0&&this.transitionAlpha>=1&&(this.level++,this.mazeWidth=Math.floor(1.2*this.mazeWidth),this.mazeHeight=Math.floor(1.2*this.mazeHeight),this.holeX=Math.floor(this.mazeWidth/2),this.holeY=Math.floor(this.mazeHeight/2),this.maze=null,this.rabbitX=this.holeX,this.rabbitY=this.holeY,this.trail=[],this.teleportingOut=!1,this.teleportingIn=!0,this.rabbitAlpha=0,this.rabbitScale=.1))}updateGameOver(){this.gameOver&&!this.teleportingIn&&!this.teleportingOut&&this.gameOverAlpha<1&&(this.gameOverAlpha+=.02)}drawMaze(){let t=this.getMaze(),e=this.inputManager.getUserScale(),i=this.ctx;i.save(),i.scale(e,e);let h=Math.ceil(this.canvas.width/e/this.cellSize)+1,s=Math.ceil(this.canvas.height/e/this.cellSize)+1,a=Math.floor(this.cameraX/this.cellSize),l=Math.floor(this.cameraY/this.cellSize);a<0&&(a=0),l<0&&(l=0);let n=a+h,o=l+s;n>this.mazeWidth&&(n=this.mazeWidth),o>this.mazeHeight&&(o=this.mazeHeight),i.strokeStyle="#75FA5C",i.lineWidth=2/e,i.setLineDash([5/e,8/e]);for(let h=l;h<o;h++)for(let s=a;s<n;s++){let a=t[h][s],l=s*this.cellSize-this.cameraX,n=h*this.cellSize-this.cameraY;if(a.north&&(i.beginPath(),i.moveTo(l,n),i.lineTo(l+this.cellSize,n),i.stroke()),a.west&&(i.beginPath(),i.moveTo(l,n),i.lineTo(l,n+this.cellSize),i.stroke()),a.east&&(i.beginPath(),i.moveTo(l+this.cellSize,n),i.lineTo(l+this.cellSize,n+this.cellSize),i.stroke()),a.south&&(i.beginPath(),i.moveTo(l,n+this.cellSize),i.lineTo(l+this.cellSize,n+this.cellSize),i.stroke()),a.hole){let t=.4*this.cellSize,h=l+.5*this.cellSize,s=n+.5*this.cellSize;i.save(),i.fillStyle="black",i.beginPath(),i.arc(h,s,t,0,2*Math.PI),i.fill(),i.strokeStyle="#75FA5C",i.lineWidth=3/e,i.shadowColor="#75FA5C",i.shadowBlur=10/e,i.setLineDash([]),i.beginPath(),i.arc(h,s,t,0,2*Math.PI),i.stroke(),i.restore()}}i.restore()}drawTrail(){let t=this.inputManager.getUserScale(),e=this.ctx;e.save(),e.scale(t,t),e.font=`${20/t}px monospace`,e.fillStyle="#75FA5C",e.textAlign="center",e.textBaseline="middle";for(let t=0;t<this.trail.length;t++){let i=this.trail[t].x*this.cellSize-this.cameraX+this.cellSize/2,h=this.trail[t].y*this.cellSize-this.cameraY+this.cellSize/2;e.fillText("â€¢",i,h)}e.restore()}drawLivesPanel(){if(this.panelAlpha<=0)return;let t=this.ctx;t.save(),t.globalAlpha=.75,t.fillStyle="#75FA5C";let e=(this.canvas.width-200)/2;t.strokeStyle="black",t.lineWidth=2,t.setLineDash([5,5]),t.beginPath(),t.moveTo(e+15,10),t.lineTo(e+200-15,10),t.quadraticCurveTo(e+200,10,e+200,25),t.lineTo(e+200,65),t.quadraticCurveTo(e+200,80,e+200-15,80),t.lineTo(e+15,80),t.quadraticCurveTo(e,80,e,65),t.lineTo(e,25),t.quadraticCurveTo(e,10,e+15,10),t.fill(),t.globalAlpha=this.panelAlpha;let i=this.lives,h=e+20;for(let e=i-1;e>=0;e--){let i=h+50*e,a=!1;1===this.lives&&this.time%1e3<500&&(a=!0),s(t,i,15,.75*this.cellSize,!1,1,.75,null,a,"black")}t.restore()}drawGameOver(){if(!this.gameOver)return;let t=this.ctx;t.save(),t.globalAlpha=this.gameOverAlpha,t.fillStyle="black",t.fillRect(0,0,this.canvas.width,this.canvas.height),t.font="40px monospace",t.fillStyle="#75FA5C",t.textAlign="center",t.textBaseline="middle",t.fillText("GAME OVER",this.canvas.width/2,this.canvas.height/2-140),t.font="20px monospace",t.fillText("Tumbling down the rabbit hole...",this.canvas.width/2,this.canvas.height/2-80),t.restore()}drawScene(){let t=this.ctx;t.fillStyle="black",t.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawMaze(),this.drawTrail();let e=this.inputManager.getUserScale();s(t,(this.rabbitX*this.cellSize-this.cameraX)*e,(this.rabbitY*this.cellSize-this.cameraY)*e,this.cellSize*e,this.facingLeft,this.rabbitAlpha,this.rabbitScale,this.time),this.gameOver||this.drawLivesPanel(),this.drawGameOver(),this.transitionAlpha>0&&(t.save(),t.globalAlpha=this.transitionAlpha,t.fillStyle="black",t.fillRect(0,0,this.canvas.width,this.canvas.height),t.restore()),this.flashAlpha>0&&(t.save(),t.globalAlpha=this.flashAlpha,t.fillStyle="#75FA5C",t.fillRect(0,0,this.canvas.width,this.canvas.height),t.restore())}}window.addEventListener("load",function(){let h=document.getElementById("gameCanvas");e=new i(h),t=new a(h,e),window.addEventListener("resize",()=>t.resizeCanvas()),t.resizeCanvas(),t.start()});</script> </body></html>
